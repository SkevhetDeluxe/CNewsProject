@model CNewsProject.Controllers.PaymentController

<h2>Select Your Membership</h2>

<form id="payment-form">
    <label for="membershipType">Select Membership Type:</label>
    <select id="membershipType" name="membershipType">
        <option value="basic">Basic - $29/month</option>
        <option value="middle">Middle - $59/month</option>
        <option value="expensive">Expensive - $189/month</option>
    </select>

    <label for="paymentFrequency">Select Payment Frequency:</label>
    <select id="paymentFrequency" name="paymentFrequency">
        <option value="monthly">Monthly</option>
        <option value="yearly">Yearly</option>
    </select>

    <div id="card-element"></div>
    <button type="submit" style="background-color: burlywood;">Pay!</button>
    <div id="card-errors" role="alert"></div>
</form>

<script>
    const stripe = Stripe('pk_test_51PpQ0VESeNuo0minP3UC6ryvrQoZoRFOd3j9iTfxxuXQEWqkgGe0HUAQeFXv2TeaXuxQKnbye3rtyg4mGdMPZw6r00o1HADNNs');

    const elements = stripe.elements();
    const cardElement = elements.create('card');
    cardElement.mount('#card-element');

    const form = document.getElementById('payment-form');

    form.addEventListener('submit', async (event) => {
        event.preventDefault();

        const paymentMethodResponse = await stripe.createPaymentMethod({
            type: 'card',
            card: cardElement,
        });

        if (paymentMethodResponse.error) {
            document.getElementById('card-errors').textContent = paymentMethodResponse.error.message;
        } else {
            const response = await fetch('/api/payment/charge', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    membershipType: document.getElementById('membershipType').value,
                    paymentFrequency: document.getElementById('paymentFrequency').value,
                    paymentMethodId: paymentMethodResponse.paymentMethod.id,
                    currency: 'usd',
                }),
            });

            const result = await response.json();

            if (result.success) {
                alert('Payment successful!');
            } else {
                alert('Payment failed: ' + result.error);
            }
        }
    });
</script>
